# 第 5 章 -- 排列组合



## 目录(Catalog)
- 5.1 计数 — 与整数的对应关系
    + 5.1.1 何谓计数
    + 5.1.2 注意 " 遗漏"  和 " 重复" 
- 5.2 植树问题 — 不要忘记 0
- 5.3 加法法则
- 5.4 乘法法则
- 5.5 置换
    + 5.5.1 置换
    + 5.5.2 归纳一下 (阶乘)
    + 5.5.3 思考题 (扑克牌的摆法)
- 5.6 排列
    + 5.6.1 排列 
    + 5.6.2 归纳一下
    + 5.6.3 属性图 -- 能够认清本质吗
- 5.7 组合
    + 5.7.1 组合
    + 5.7.2 归纳一下
    + 5.7.3 置换, 排列, 组合的关系
- 5.8 思考题练习
    + 5.8.1 重复组合
    + 5.8.2 也要善于运用逻辑
- 5.9 本章小结


## 生词(New Words)
- **substitution [sʌbstɪ'tjuːʃn] --n.代替, 替换**
    + direct substitution 直接取代
    + We don't know exactly when the substitution took place. 
        我们不知道以假换真是什么时候发生的事. 
- **permutation [pɜːmjʊ'teɪʃ(ə)n] / ['pɝmjʊ'teʃən] --n.排列; 置换.**
    + permutation and combination. n.[数] 排列组合.
- **arrangement [ə'rendʒmənt] --n.安排; 排列; 布局.**
    + I agree to this arrangement. 我同意这个安排.
    + course arrangement. 课程安排.
    + The arrangement is all right with me. 这样安排对我很适宜.
    + This arrangement has a lot of advantages.
      这种安排有很多好处.
 - **inclusion [ɪn'kluʒn] --n.包含; 包括.**
 - **exclusion [ɪk'skluʒn] --n.拒绝; 排出**
- **conclusion [kən'kluːʒ(ə)n] --n.结论, 结局**
    + It is too early to draw a conclusion. 现在下结论还为时过早. 
    + Let's not jump to any conclusion, all right? 先别急着下结论 行吗?
- **combination [kɒmbɪ'neɪʃ(ə)n]{UK} --n.组合; 合并; 结合.**
    + in combination with. ...与...结合
    + And then I do a combination of them. 然后我会得出它们的一个组合.

## 内容(Content)
### 5.1 计数 — 与整数的对应关系
##### 5.1.1 何谓计数
##### 5.1.2 注意 " 遗漏"  和 " 重复" 


### 5.2 植树问题 — 不要忘记 0
- 在 10 米长的路上, 从路的一端起每隔 1 米种一棵树, 那么需要种多少棵树?
  
  答: 从路的一端起每隔 1 米种一棵树的意思就是在距离路的一端
  0、1、2、3、4、5、6、7、8、9、10 米的位置种树. 因此, 需要 11 棵树


### 5.3 加法法则
- 我们先来看下面这个问题
    + 在一副扑克牌中, 有 10 张红桃数字牌(A、2、3、4、5、6、7、8、9、10),
      3 张红桃花牌(J、Q、K). 那么红桃共有多少张?

      答案: 数字牌 10 张, 加上花牌 3 张, 共有 13 张. 
- 上面的问题非常简单, 它所使用的就是加法法则. 加法法则就是将 " 无重复"  元素的 2
  个集合 $A, B$ 相加, 得到 $A \cup B$ (并)的元素数.
    + $A \cup B$ 的元素个数 = $A$ 的元素个数 + $B$ 的元素个数.
  
  如果将集合 $A$ 的元素数写作 $|A|$, 集合 $B$ 的元素数写作 $|B|$,
  那么加法法则就可以用以下等式表示.
  $$
    |A \cup B| = |A| + |B|
  $$
  在上题中, 集合 $A$ 就相当于红桃数字牌, 集合 $B$ 就相当于红桃花牌.
  <p style=" text-align: center" >
    红桃牌的张数 = 红桃数字牌的张数 + 红桃花牌的张数
  </p>
- 但是, **加法法则只在集合中没有重复元素的条件下成立.** 在重复的情况下,
  必须减去重复才能得到正确的数量. 我们接着来看一题.
- 思考题: 控制亮灯的扑克牌
  
  在一副扑克牌中, 有 13 个等级 (A、2、3、4、5、6、7、8、9、10、J、Q、K). 这里,
  我们分别将 A, J, Q, K 设为整数 1, 11, 12, 13.
  ```
        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
        A                              J,  Q,  K
  ```
  在你面前有一个装置, 只要往里面放入 1 张牌, 它就会根据牌的级别控制灯泡的亮灭. 
  我们设放入的扑克牌的级别为 $n$ (1 ~ 13 的整数),
    + 若 $n$ 是 2 的倍数, 则亮灯. 
    + 若 $n$ 是 3 的倍数；也亮灯.
    + 若 $n$ 既不是 2 的倍数, 也不是 3 的倍数, 则灭灯. 
  
  往这个装置中依次放入 13 张红桃, 其中亮灯的有多少张牌呢？
  
  答: 
    + 在数字 1 ~ 13 里面, 2 的倍数有 2, 4, 6, 8, 10, 12, 共 6 个. 
    + 在数字 1 ~ 13 里面, 3 的倍数有 3, 6, 9, 12, 共 4 个
    + 既是 2 的倍数, 又是 3 的倍数的有 6, 12, 共 2 个. 
  
  因此, 亮灯的牌数为 6 + 4 - 2 = 8. 

- `容斥原理(The Principle of Inclusion and Exclusion)`
  
  大家有没有注意到上面 2 的倍数和 3 的倍数中有 " 重复"  的数字呢? 2 的倍数和 3
  的倍数的共同部分 (重复部分), 就是 6 的倍数(图 5-6)

  <img src=" ../code-math-one_images/5-6.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >

  **2 的倍数的个数, 加上 3 的倍数的个数, 再减去重复的个数, 就是`容斥原理`**.
  这是 " 考虑了重复元素的加法法则"  . 

  集合 $A$, $B$ 的元素总数 = $A$ 的元素数 + $B$ 的元素数 - $A$ 和 $B$ 共同的元素数

  如果将集合 $A$ 的元素数写作, 容斥原理可以用下述等式表示. 

  $A \cup B$ = $A$ + $B$ - $A \cap B$

  即 $A$ 的元素数 $|A|$ 和 $B$ 的元素数 $|B|$ 相加, 再减去重复的元素数 $A \cap B$

  在使用容斥原理时, 必须弄清 " 重复的元素数有多少" . 这也是 " 认清计数对象性质"  的一个例子. 


### 5.4 乘法法则 (组合 / 元素配对)
- 本节, 我们介绍根据 2 个集合进行 " 元素配对"  的法则.
- 思考题: 红桃的数量
    + 在一副扑克牌中, 有红桃, 黑桃, 方片, 梅花 4 种花色. 每个花色都有
      A, 2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K 这 13 个等级. 那么,
      一副扑克牌共有多少张? (这里除去王牌)
    + 答案: 在一副扑克牌中, 4 种花色都各有 13 张. 因此,
      要求的牌数可通过下述算式得出 4 $\times$ 13 = 52
    + 乘法法则: 将扑克牌排成图 5-7 所示的长方形,
      就能明白为什么要用乘法来计算元素数了.
      
      <img src=" ../code-math-one_images/5-7.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >
    + 扑克牌有 4 种花色, 每种花色又分别有 13 张. 遇到这种 **" 分别有" ** 的情况时, 
      往往只需要乘法计算便可求出结果. 这又是 " 认清计数对象性质"  的一例. 
      
      这里所用的是**乘法法则**. 
    + **有 A 和 B 两个集合, 现假设要将集合 A 的所有元素与集合 B
      的所有元素的组合起来. 这时组合的总数就是两个集合的元素数相乘所得出的结果.**
      我们将集合 A 的元素数写作 $|A|$, 集合 B 的元素数写作 $|B|$,
      那么元素的组合数就是
      $$
        |A| \times |B|
      $$
      从集合 $A$ 和集合 $B$ 中各取出一个元素作为一组, 所有这种组合的集合即为
      $|A| \times |B|$, 可以表示为
      $$
         |A \times B|= |A| \times |B|
      $$
      假设 $A$ 为扑克牌花色的集合, B 为扑克牌级别的集合, 那么这些元素列举如下. 
        + 集合 $A$ = {红桃, 黑桃, 方片, 梅花}
        + 集合 $B$ = {A,2,3,4,5,6,7,8,9,10, J, Q, K}

      而集合 $A \times B$ 列举如下

      集合 $A \times B$ = { <br>
        (红桃, A), (红桃, 2), (红桃, 3), $\cdots$, (红桃, K),

        (黑桃, A), (黑桃, 2), (黑桃, 3), $\cdots$, (黑桃, K),

        (方片, A), (方片, 2), (方片, 3), $\cdots$, (方片, K),

        (梅花, A), (梅花, 2), (梅花, 3), $\cdots$, (梅花, K),

      }
- 思考题: 3 个筛子
    + 将 3 个写有数字 1 到 6 的骰子并列放置, 形成一个 3 位数, 共能形成多少个数字?
      (例如, 图 5-8 所示排列, 形成数字 255)
      
      <img src=" ../code-math-one_images/5-8.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >
    + 答案: 第 1 个筛子有 1, 2, 3, 4, 5, 6 共 6 种情况.
      
      与第 1 个筛子的 6 种情况相对应, 第 2 个筛子也有 6 种情况.
      **因此前 2 个筛子共有 6 $\times$ 6 种情况. (乘法法则)**

      第 1 个筛子有 6 种情况, 与之相对应的第 2 个筛子也有 6 种情况,
      而在此基础上第 3 个筛子又有 6 种情况.
      **因此 3 个筛子共有 6 $\times$ 6 $\times$ 6 种情况 (乘法法则).**
    + 分析: 我们假设第一个筛子的 6 种情况为集合 $A$, 第二个筛子的 6 种情况为集合 $B$,
      第三个筛子的 6 种情况为集合 $C$, 那么分别表示出来为:
        - $A$ = {1, 2, 3, 4, 5, 6}; 
        - $B$ = {1, 2, 3, 4, 5, 6}; 
        - $C$ = {1, 2, 3, 4, 5, 6}; 
      
      将 3 个集合的元素组合起来, 组合的总数就是 3 个集合的元素数相乘所得到的结果,
      即 $|A| \times |B| \times |C|$.
- 思考题: 32 个灯泡
    + 1 个灯泡有 " 亮"  和 " 灭"  2 种状态, 若将 32 个这样的灯泡排成一排,
      则共有多少种亮灭模式?

      <img src=" ../code-math-one_images/5-9.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >
    + 答: 我们把 1 个灯泡看作是一个包含 " 亮" (1) 和 " 灭" (0)
      2 个元素的一个集合($F$), 表示为 $F = \{0, 1\}$. 
      那么 32 个灯泡就有 32 个这样的集合, 即:
      $$
        F_1 = \{0, 1\}, \\
        F_2 = \{0, 1\}, \\
        F_3 = \{0, 1\}, \\
        F_4 = \{0, 1\}, \\
        F_5 = \{0, 1\}, \\
        F_6 = \{0, 1\}, \\
        \cdots \cdots   \\
        F_{32} = \{0, 1\}
      $$
      32 个灯泡排成一排, 也就是把 32 个灯泡组合起来, 我们根据由
      `集合的元素组合起来, 就是把集合的元素数相乘所得到的结果` 这个前提,
      来用乘法法则求出 32 个灯泡排成一排的组合数, 即:
      $$
      \underbrace{2 \times 2 \times \cdots \times 2}_{32 个}
        \quad = 2^{32} \quad = 42 9496 7296
      $$

      tip: 从结果可以看出 32 个明灭的灯泡组合起来有 42 亿种情况,
      这大概就是所说的指数爆炸吧.
    + 通常 $n$ 位 2 进制数可以表示的数的总数为 $2^n$. 这是程序员应掌握的基本知识.

### 5.5 置换 ( $\color{red}{n! = P_n^{n}}$ )
##### 5.5.1 置换
- 先给出置换的定义:

  **`置换(substitution)`: 将 $n$ 个事物按顺序进行排列称为`置换`.**

  Tip: 一般 `置换` 都是在一个集合内做操作,
  即把一个集合内的元素调换顺序来形成另外一种排法.
  (也可以说是: $n$ 个事物的所有排法.)

  Tip02: 我们说把 $n$ 个事物按顺序进行排列, 这 $n$ 个事物, 一般默认是没有重复的,
  想一想如果有重复的元素存在, 该如何产生 "顺序" 呢, 是不是?

- 思考题(1): 3 张牌的置换
    + 如果将 $A, B, C$ 这 3 张牌按照 $ABC, ACB, BAC \cdots\cdots$ 等顺序排列,
      那么有多少种排法?
    + 答案: 经过思考, 我们知道 3 张牌共有 6 种排法. 如下图 5-10所示
      
      <img src=" ../code-math-one_images/5-10.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5">
    + $A, B, C$ 3 张牌的置换总数, 可以通过下述步骤得出.
        - 第 1 张牌 (最左边的牌), 从 $A, B, C$ 3 张中选出 1 张. 即,
          第 1 张牌有 3 中选法.
        - 第 2 张牌, 从已选出的第 1 张牌以外的 2 张中选出 1 张. 即,
          第 2 张牌与第 1 张牌的选法相对, 分别有 2 种选法.
        - 第 3 张牌, 只有一张可选.
    + 因此, 3 张牌的所有排列方法 (置换的总数), 可以通过如下计算得出.
    + 第 1 张牌的选法 $\times$ 第 2 张牌的选法 $\times$ 第 3 张牌的选法 = 
      3 $\times$ 2 $\times$ 1.


##### 5.5.2 归纳一下 (阶乘)
- 这次, 我们增加到 5 张牌. 5 张牌($A, B, C, D, E$)的置换总数又是多少呢?
  思路和 3 张时相同. 
    + 第 1 张的选法有 5 种, 
    + 第 2 张的选法有 4 种, 
    + 第 3 张的选法有 3 种, 
    + 第 4 张的选法有 2 种, 
    + 第 5 张的选法有 1 种, 
  
  因此, 5 张牌的置换总数计算如下:

  5 $\times$ 4 $\times$ 3 $\times$ 2 $\times$ 1 = 120
  
  答案: 120 种. 

- **`阶乘 (factorial)`**: 
  通过观察可知上面的算式就是按 5, 4, 3, 2, 1 这样将递减的整数相乘.
  这种乘法经常在计算有多少种情况时出现, 它可以表示为 $5!$ (读作: 5 的阶乘)

  $5!$ = 5 $\times$ 4 $\times$ 3 $\times$ 2 $\times$ 1

  $5!$ 称为 5 的 阶乘(factorial), 是因乘数呈阶梯状递减而得名.
  5 张牌的置换总数为 5!. 我们来实际计算一下阶乘的值. 
  $$
    \begin{align}
    5! & = 5 \times 4 \times 3 \times 2 \times 1 = 120   \\
    4! & = 4 \times 3 \times 2 \times 1=24  \\
    3! & = 3 \times 2 \times 1=6 \\
    2! & = 2 \times 1=2 \\
    1! & = 1 = 1 \\
    0! & = 1
    \end{align}
  $$
  要注意 0 的阶乘 ($0!$) 不是 0, 而被定义为 1. 这是数学里的规定. 

##### 5.5.3 思考题 (扑克牌的摆法)
- 思考题(2): 将一副扑克牌里的 52 张 (不包括王牌) 摆成一排, 共有多少种摆法?
  
  答案: 这是 52 张牌的置换, 因此有:
  $$
  \begin{align}
        52! & = 52 \times 51 \times 50 \times \cdots \times 1 \\[2ex]
            & = 80658175170943878571660636856403766975289505440883277824000000
    \end{align}
  $$
  居然得出这么大一个数字 (62 位)!

- Tips: $1! \cdots 52!$ 的阶乘. 随着 n 的增大, 阶乘 $n!$ 的结果呈爆炸式增长.   
  
   <img src=" ../code-math-one_images/5-1.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5">


### 5.6 排列 ( $\color{red}{P_n^{k}}$ )
- 在上一节 5.5 置换 的学习中, 我们罗列了 $n$ 个事物的所有排法. 而本节,
  **我们将学习从 $n$ 个事物中取出一部分进行 " 排列" .**
##### 5.6.1 排列 
- 思考题(1) - 从 5 张牌中取出 3 张进行排列.
    + 你现在手上持有 $A, B, C, D, E$ 共 5 张牌. 要从这 5 张牌中取出 3 张进行排列.
      请问有多少种排法? 
      
      答: 60 种. 如下图:
       <img src=" ../code-math-one_images/5-11.png"  
            style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >
    
  `排列(permutation)`: 我们将上题那样的排法称作从 5 张里面取出 3 张的 `排列`.

  请注意, **排列与置换相同, 也是要考虑顺序的.** 例如, $ABD$ 和 $ADB$
  都是由 $A, B, D$ 这 3 张牌组成的, 但是它们的顺序不同, 因此是不同的排列,
  需要分别计数.

  在求 5 张里面取 3 张牌的排列总数时, 我们一张一张顺次排列,
  直到达到规定的牌数为止. 即按照如下方式计算:
    + 第 1 张的取法有 5 种, 
    + 第 2 张的取法有 4 种, 
  + 第 3 张的取法有 3 种.

  由此可得, 5 $\times$ 4 $\times$ 3 = 60.

##### 5.6.2 归纳一下 (排列的定义)
- 大家现在已经想到了排列的归纳方法了吧. 假设从 $n$ 张牌出取出 $k$ 张进行排列:
    + 第 1 张是 "从 $n$ 张中取出 1 张" , 因此有 $n$ 种取法. 
    + 第 2 张的取法与以上相对, 有 $n - 1$ 种. 
    + 第 3 张的取法与以上相对, 有 $n - 2$ 种. 
    + $\cdots \cdots$
    + 第 $k$ 张的取法与以上相对, 有 $n - k + 1$ 种. 
    
  因此, 从 $n$ 张牌中取出 $k$ 张进行排列的总数就是:
  $$
    n \times (n - 1) \times (n - 2) \times \cdots \times (n - k + 1)
  $$
  这个式子很重要, 一定要看仔细. 特别是最后一项 $(n - k + 1)$, 必须理解透彻. 
  
  为了更清楚地表示有多少项相乘, 我们将第一项 $n$ 写作 $(n - 0)$,
  最后一项 $(n - k + 1)$ 写作$(n - (k - 1))$. 这样就得到如下式子
  $$
    \underbrace{(n - 0) \times (n - 1) \times (n - 2) \times \cdots \times (n - (k - 1))}_{k 个}
  $$
  
  即将所有项 $(n - 0)$, $(n - 1)$, $(n - 2)$, $\cdots \cdots$,
  $(n - (k - 1))$ 相乘. 其中各项中 $n$ 减去的数字分别为 "0 到 $(k-1)$" ,
  所以我们可知一共有 $k$ 项相乘. 这里就用到了本章最开始介绍的
  "植树问题" 的思考方法.
  
  ***Additional Info*:** 为什么这里作者要着重强调从 $n$ 个元素中取出 $k$
  个进行排列, 是一共有 $k$ 项相乘呢? A: 因为下面我们会给出排列的总数的通用计算方法,
  在通用计算方法中便会用到 $k$.
  
- 如上所述,
  
  **`排列(permutation)`**: 我们将从 $n$ 个不同元素中取出 $k$
  个并按照一定顺序排列的方法称作 `排列`,
  排列的总数记作: $\color{red}{P_{n}^{k}}$.
  
  并能够得到以下等式:
  $$
    \begin{align}
        P_n^k =  \underbrace{(n - 0) \times (n - 1) \times (n - 2) \times \cdots \times (n - (k - 1))}_{k 个}
    \end{align}
  $$
  只要已知  $n$ 和 $k$ 两个数即可求出排列总数, 所以 $P_n^k$ 中的 $n$ 和 $k$ 小写,
  P 是 permutation 的缩写.
  
  例如, 求 5 张牌中取出 3 张进行排列的总数是, $n = 5, k = 3$, 因此可以如下计算:

  5 张牌中取 3 张进行排列的总数 = $P_5^3$ = $5 \times 4 \times 3$ = 60.

  "5 张牌中选 0 张进行排列的总数" 为 $P_5^0$, 但它不是 0, 而被定义为 1. 即:
  $P_5^0 = 1$.
    + tip: 实际上这个很好理解, "选 0 张" 即是说你没得选, "没得选"
      本身就是一种情况嘛, 对吧? 所以排列总数也就是 1 嘛.
  
  上一节介绍的 "置换" 也能用这种方法表示. $n$ 个数置换的总数就可以记作 $P_n^n$.

- 用 `阶乘` 表示:

  很多情况下, 也常用已下阶乘的形式来表示排列:
  $$
    P_n^k = \frac{n!}{(n - k)!}
  $$
  这个式子看起来多少有点晦涩难懂, 不过分母 $(n - k)!$ 可与分子 $n!$ 的最后 $n - k$
  项鱼粉. 看下述算式应该更容易理解.
  $$
    \begin{align}
        P_5^3 & = \frac{5!}{(5 - 3)!} \\
        & = \frac{5 \times 4 \times 3 \times 2 \times 1}{2 \times 1} \\
        & = 5 \times 4 \times 3
    \end{align}
  $$
  
  上面的 $(n - 0) \times (n - 1) \times (n - 2) \times \cdots \times (n - (k - 1))$
  如果使用阶乘表示($ P_n^k$), 就可以不写省略号, 使得算式的内容更明确.
  这也就是为什么在以后学习线性代数, 微积分, 概率论的时候有很多新写法的原因.

##### 5.6.3 树形图 -- 能够认清本质吗
- 从 3 张牌中取出 3 张进行排列时, 同一张牌不能选 2 次. 因为可选择的第 2, 第 3
  张的牌数递减. 为了看得更明白一些, 我们用 `树形图` 来表示 (图 5-12)

  <img src=" ../code-math-one_images/5-12.png"  
            style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >

  请把图 5-12 想象成左面是 "根", 右面是 "枝" 的树. 从根生出 3 根树枝, 这表示第 1
  张牌有 3 种选法. 这 3 根树枝又都分别再生出 2 根枝, 这表示第 2 张牌有 2 种选法.
  最后都只有 1 根枝. 从图中可见, 树枝呈 $3 \rightarrow 2 \rightarrow 1$ 递减状.

  树形图是有助于 "认清计数对象性质" 的有效工具.

### 5.7 组合 ( $\color{red}{C_n^{k}}$ )
##### 5.7.1 组合
- `置换` 和 `排列` 都需要考虑顺序, 而本节我们要介绍的是 "不考虑顺序的方法"
  -- `组合`.
- 假设现在有 $A, B, C, D, E$ 五张牌. 要从这 5 张牌中取出 3 张牌,
  **并且不考虑它们的顺序**, 即以 3 张牌为 1 组进行选择. 例如, $ABE$ 和 $BAE$
  应视为同一组. 这时, 3 张牌的取法如下, 共有 10 种:
  
  <img src=" ../code-math-one_images/5-14.png"  
            style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5" >

  这种取法称为 `组合(combination)`. 

  **我们将从 $n$ 个不同元素中取出 $k$ 个, 但是不考虑它们的顺序, 这种取法称为 `组合`. **
  
  `置换(substitution)` 和 `排列(permutation)` 是考虑顺序的, 而 `组合`
  则不考虑顺序.

- 要计算 5 张里面取 3 张的组合总数, 只要这样考虑就行了.
    + (1) 首先, 和排列一样 "考虑顺序"  进行计数.
    + (2) 其次, 除以重复计数的部分 (重复度: 即 3 张牌的置换总数 $3 \times 2 \times1$). 
    
  首先, 和 `排列` 一样 "考虑顺序" 进行计数. 但是作为 `组合` 来讲这样并不正确.
  因为若按 `排列` 计数, 有 $ABC, ACB, BAC, BCA, CAB, CBA$ 这 6 中排法,
  而在 `组合` 中这 6 种排法是作为 1 组来计算的.(tip: 因为这 6 种排法是 
  $A, B, C$ 3 元素按不同的顺序来排列的, 但是 `组合` 是不考虑顺序的, 所以在
  `组合` 中这 6 种排法实际上就是一种排法.) 即若像 `排列` 那样考虑顺序则会产生
  6 倍的重复计数.
  
  这里出现的数字 6 (重复度), 是 3 张牌按顺序 `排列` 的总数, 即 3 张牌的
  `置换`总数( $3 \times 2 \times 1$). 因为考虑顺序而产生了重复,
  所以只要用排列的总数除以重复度 6, 就能得到组合的总数.
  
  5 张里面取 3 张的组合的总数写作 $C_{5}^{3}$ (C 是 combination 的首字母).
  计算如下:
  
  5 张里面取 3 张的组合的总数 =  $C_{5}^{3}$
  $$
  \begin{align}
        C_{5}^{3} 
        & = \frac{5 张里面取 3 张的排列总数}{3 张的置换总数} \quad
            \frac{\cdots 考虑顺序的\color{green}{排列总数}}{\cdots 重复度(\color{green}{置换总数})}    \\[2ex]
        & = \frac{P_{5}^{3}}{P_{3}^{3}}  \\[2ex]
        & = \frac{5 \times 4 \times3}{ 3 \times 2 \times 1}  \\[2ex]
        & = 10
    \end{align}
  $$
  
  这里使用的 **先考虑顺序进行计数, 然后除去重复度** 的方法,
  是计算组合时常用的计算方法.

##### 5.7.2 归纳一下
- 接下来我们将牌数抽象化, 求出 $n$ 张牌中取出 $k$ 张的组合总数.

  首先, 从 $n$ 张牌中按顺序取出 $k$ 张牌. 而这时 $k$ 张的置换总数是重复的,
  所以要除以这个重复度.
  $$
  \begin{align}
        C_{5}^{3}
        & = \frac{从 n 张里面取 k 张的排列总数}{k 张的置换总数} \\[2ex]
        & = \frac{P_{n}^{k}}{P_{k}^{k}} \\[2ex]
        & = \frac{\frac{n!}{(n-k)!}}{k!} \\[2ex]
        & = \frac{n!}{(n-k)!} \cdots \frac{1}{k!} \\[2ex]
        & = \frac{n!}{(n-k)! k!}
    \end{align}
  $$
  这样, 从 $n$ 张里取 $k$ 张的组合总数为  
  $$
    C_{n}^{k} = \frac{n!}{(n-k)! k!}
  $$

##### 5.7.3 置换, 排列, 组合的关系
- `置换` 和 `组合` 相结合就是 `排列`, 大家知道为什么吗?

  下面我们使用逆向推法来证明: `排列` 是 `置换` 和 `组合` 相结合的结果.
    + (1) 我们先来看从 5 张牌($A, B, C, D, E$) 中取 3 张的排列. 根据上面
      `5.6 排列` 的知识我们知道是: 
      
      $P_{5}^{3}$ = $5 \times 4 \times 3$ = 60 种, 即如下图:
  
      <img src=" ../code-math-one_images/5-17.png"  
            style=" margin-left: 0; border-radius: 4px; width: 66%;
                    box-shadow: 1px 1px 3px 2px #e5e5e5" >
    + (2) 那么再根据 `5.5 置换` 的知识我们来看一下: "3 张牌按顺序排列,
      有多少种排法?" 即上面 `5.5 置换` 的思考题(1), 现在我们已经知道是:
      
      $P_3^3$ = $3 \times 2 \times 1$ = 6
    + (3) 最后根据本章节的知识, "从这 5 张牌中取出 3 张牌, 且不考虑它们的顺序"
      就是 `组合`, 即:
      $C_{5}^{3}$ = $\frac{P_{5}^{3}}{P_{3}^{3}}$
    + (4) 现在我们把 (3) 的公式变形, 即:
      $P_{3}^{3} \times C_{5}^{3} = P_{5}^{3}$ $\quad$ `{1}`

- 最后我们总结一下: `置换`, `排列` 和 `组合`:
  
  `置换` 表示 "3 张牌的交替排列方法".

  `组合` 表示 "3 张牌的取法".
  
  两者结合就是 "取出 3 张牌, 进行交替排列", 即表示 `排列`.

  " 3 张的置换"  $\times$ " 从 5 张中取 3 张的组合"  = "
  从 5 张中取 3 张的排列 (即: `{1}`).


### 5.8 思考题练习
##### 5.8.1 重复组合
- 思考题: 药品调剂
    + 假设我们想把几种颗粒状的药调剂成一种新药. 药品有 A, B, C 三种.
      新药调剂的规则如下. 
        - (1) 从  A, B, C 这 3 种药品中一共取 100 粒进行调剂. 
        - (2) 调剂时, A, B, C 这 3 种药每种至少要有 1 粒. 
        - (3) 不考虑药品调剂的顺序.
        - (4) 同种药的每粒都相同. 

    这种情况下, 新药调剂的组合共有多少种？

    + 提示 1: 这是一个重复组合的问题. 
      
      同种药品可以放入多粒进行调剂(可以重复). 但是同种药品每粒都相同
      并且不考虑调剂顺序(组合). 

      由于使用 100 粒药品进行调剂是既定的, 所以如果多放了某种药品,
      那么其他药品就只能相对地少加了. 关键在于如何把握 3 种药品的数量关系
      
      3 种药品**不需要排序**, 所以这里以固定的顺序来解答会比较轻松. 

    + 提示 2
      
      我们将问题缩小, 看看能获得什么启示. 

      现假设有 A, B, C 三种药, 而调剂用的药品从 100 粒改为 5 粒. 

      如图 5-18, 先准备好 5 个放药品的盘子, 再在盘子之间放入 2 块 "隔板" .
      并规定, 从左起, 第 1 块隔板左边的 2 个盘子放药品 A,
      两块隔板之间的盘子放药品 B,
      第 2 块隔板右面的盘子放药品 C (这就固定了 A, B, C 的顺序).
      这个规定正好和问题中的规则一致, 隔板的放法和药品的调剂方法一一对应. 

      <img src=" ../code-math-one_images/5-18.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5">

      从上图可以看出来, 如果调剂 5 粒药, 就需要 5 个盘子,
      5 个盘子之间有 4 个间隙, 根据题目要求: "使用 A, B, C 三种药来调剂,
      每种至少1 粒", 我们只需要把 2 个隔板使用不同的组合放置在 4 个间隙中就行了,
      这样便达到了调剂 5 粒药的要求, 我们把这几个组合排出来看一下:
      ```
        A A A | B | C
        A A | B B | C  (tip: 上图的黑线实隔板)
        A A | B | C C
        A | B B B | C  (tip: 上图的虚线隔板, 可以看出上图实际上有一点点问题)
        A | B B | C C 
        A | B | C C C
      ```
      此处重点就是把 2 个隔板使用不同的组合放置在 4 个间隙中, 那么使用组合表示就是:
      $\color{#d6660c}{C_4^2}$.
      
      我们弄明白了上面缩小版的 5 粒药调剂, 那么 100 粒的情况又如何呢?
    + 思考题答案:
      
      我们将问题归纳为 "从 $k$ 种药品中选出 $n$ 粒", 并同样使用提示 2 中的 "隔板".
      那么, 盘子的数量为 $n$ 个, 能放置隔板的地方为 $n - 1$ 处, 隔板的数量为 $k - 1$
      块, 因此要求的调剂方法的总数为 $\color{#d6660c}{C_{n-1}^{k-1}}$.
    
      因此, 从 3 种药品中选出 100 粒的方法计算如下. 此时 $n = 100, k = 3$,
      $$
        \begin{align}
            C_{n-1}^{k-1} & = C_{100 - 1}^{3 - 1}  \\
            & = \frac{99 \times 98}{2 \times 1}  \\
            & = 4851
        \end{align}
      $$
      由以上算是得出调剂方法共有 4851 种.

##### 5.8.2 也要善于运用逻辑
- 思考题: 至少有一端是王牌
    + 现在有 5 张扑克牌, 其中王牌 2 张, J、Q、K 各 1 张. 将这 5 张牌排成一排,
      左端或右端至少有一端是王牌的排法有多少种？（不区分大小王牌）
      
      <img src=" ../code-math-one_images/5-19.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5">

    + 提示:
    
      如何使用 "至少有一端是王牌" 和 "不区分大小王牌" 这两个条件是关键要注意
      "至少有一端是王牌" 的条件包括两端都是王牌的情况. 而对于 "不区分大小王牌"
      这个条件, 在求 $C_n^k$ 时我们要先区分大小王牌计算, 再除以重复度". 

    + 思考题答案: 

      首先按区分大小王牌计数, 然后除以王牌的重复度. 

      我们将两张王牌设为 $x_1$、$x_2$, 算出 $x_1$、$x_2$、J、Q、K
      五张牌排成一排时左端和右端至少有一端是王牌的情况. 
      
      (1) 左端是王牌的情况
        + 假设将王牌置于左端, 那么左端的选法就有 $x_1$ 或 $x_2$,这 2 种情况.
          每种情况下剩余 4 张牌都可以自由排列. 因此, 左端是王牌的情况下,
          使用乘法法则:
            - 左端的王牌选法 $\times$ 剩余 4 张牌的换位 = 2 $\times$ $P_4^4$  
              = 2 $\times$ $4!$  
              = 48  
              计算结果为 48 种. 不过其中已经包含了 "两端都是王牌的情况".
      
      (2) 右端是王牌的情况
        + 只是左右颠倒一下, 因此和 (1) 一样有 48 种.
      
      (3) 两端都是王牌的情况
        + 假设将王牌置于两端, 两端的选法就是 2 张王牌的换位, 因此有 $P_2^2$ 种情况.
          而此时剩余 3 张牌可以自由排列. 那么, 两端是王牌的情况就是:
    
          两端的王牌选法 $\times$ 剩余 3 张牌的置换 = $P_2^2 \times P_3^3$  
          = $2! \times 3!$  
          = 12  
          计算结果为 12 种.

          接着只要计算 (1) + (2) - (3) 就能求出 "至少有一段是王牌的**排列**
          (容斥原理), 然后再除以王牌的重复度就能得出 "至少有一端是王牌的**组合**".

          因为王牌有 2 张, 因此重复度是 2 ($P_2^2$ = 2). 计算过程如下:

          $\frac{(1) + (2) - (3)}{王牌的重复度} = \frac{48 + 48 - 12}{2}$
          = 42. 

    + **另外一种使用逻辑的解法:**
      这里再给大家介绍一种解法. 如果使用逻辑, 本题可以更简单地计算拿出来.
      
      "至少有一端是王牌" 也就是 "两端都不是王牌" 的否定. 那就意味着只要从
      "所有的排法" 中减去 "两端都不是王牌的排法" 就能得出答案.
      画个文氏图更有助于理解:
      
      <img src=" ../code-math-one_images/5-20.png" 
        style=" margin-left: 0; border-radius: 4px; width: 66%;
                box-shadow: 1px 1px 3px 2px #e5e5e5">
      
      (1) 所有的排法:
        - 先求出所有 5 张牌区分大小王牌时的置换, 再除以王牌的重复度,
          就能得出所有的排法. 

          $\frac{P_5^5}{2} = \frac{5!}{2} = 5 \times 4 \times 3 = 60$
         
          Added: 此处添加一下说明, 为什么是除以 2, 我们把大小王牌看做 "王 1" 和
          "王 2", 此处给几个默认的排列看一下:
          ```
            (王 1), J, Q, K, (王 2),
            (王 2), J, Q, K, (王 1),

            (王 1), J, K, Q, (王 2),
            (王 2), J, K, Q, (王 1),
            
            ......
          ```
          此时可以看出, 上面是区分大小王牌的排法, 由于题中要求是**不区分大小王牌**
          的, 所以我们要除以 2.
      (2) 两端都不是王牌
        - 两端应从 J, Q, K 这 3 张牌中选出 2 张进行排列, 即 $P_3^2$. 而剩余的 3
          张牌有 $P_3^3$ 种排法. 最后除以王牌的重复度.

          $\frac{P_3^2 \times P_3^3}{2} = \frac{(3 \times 2) \times (3 \times 2 \times 1)}{2} = 18$
          
          因此, 可以通过下述算式求出至少有一端为王牌的情况.

          (1)所有的排法 - (2)两端都不是王牌的排法 = 60 - 18 = 42

          答案: 42 种.

### 5.9 本章小结
- 本章学习了以下计数方法. 
    + 植树问题
    + 加法法则
    + 乘法法则
    + 置换
    + 排列
    + 组合
    
    
  
这些都是基本方法, 但死记硬背是毫无意义的. 重要的是, 我们要充分理解这些方法的意义. 
  为了防止 "遗漏" 和 "重复" , 我们不能只是 "仔细地计数", 更重要的是 "认清计数对象的性质" . 
  
  不管计数时多么仔细, 一旦遇到大数, 人总还是会出错的.
  因此为了避免出错就需要熟练掌握以上这些计数方法. 换言之, "计数方法" 就是
  "为避免单纯地逐一计数" 而存在的. 